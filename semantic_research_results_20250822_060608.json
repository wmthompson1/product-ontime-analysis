{
  "timestamp": "2025-08-22T06:06:08.894335",
  "test_results": [
    {
      "test_id": "supply_chain_001",
      "domain": "supply_chain",
      "query": "Show suppliers with delivery performance below 95% affecting production schedule",
      "generated_sql": "```sql SELECT s.supplier_id, s.supplier_name, AVG(dd.ontime_rate) AS average_ontime_rate FROM SUPPLIERS s JOIN DAILY_DELIVERIES dd ON s.supplier_id = dd.supplier_id GROUP BY s.supplier_id, s.supplier_name HAVING AVG(dd.ontime_rate) < %s; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query joins the SUPPLIERS and DAILY_DELIVERIES tables on the supplier_id field. It then groups the results by supplier_id and supplier_name, and calculates the average ontime_rate for each supplier. The HAVING clause filters out suppliers with an average ontime_rate of 95% or higher, leaving only those suppliers with an average ontime_rate below 95%.",
      "safety_check": true,
      "quality_score": 0.4,
      "concept_coverage": 0.25,
      "contextual_hints_count": 3,
      "acronyms_detected": 2,
      "timestamp": "2025-08-22T06:05:37.906090"
    },
    {
      "test_id": "quality_001",
      "domain": "quality_control",
      "query": "Find products with NCM rates trending above industry standards",
      "generated_sql": "```sql WITH defect_rates AS ( SELECT pd.product_line, AVG(pd.defect_rate) AS avg_defect_rate FROM PRODUCT_DEFECTS pd WHERE pd.defect_type = 'NCM' GROUP BY pd.product_line ) SELECT p.id, p.description, dr.product_line, dr.avg_defect_rate FROM products p JOIN defect_rates dr ON p.description = dr.product_line WHERE dr.avg_defect_rate > %s ORDER BY dr.avg_defect_rate DESC; ```",
      "confidence": 0.9,
      "complexity": "QueryComplexity.MEDIUM",
      "explanation": " The query first creates a CTE (Common Table Expression) named 'defect_rates' that calculates the average defect rate for each product line where the defect type is 'NCM'. Then it joins this CTE with the 'products' table on the product description and product line. The WHERE clause filters out the products with an average defect rate less than or equal to the industry standard (2.5%). The results are ordered in descending order of the average defect rate.",
      "safety_check": true,
      "quality_score": 0.5,
      "concept_coverage": 0.5,
      "contextual_hints_count": 5,
      "acronyms_detected": 5,
      "timestamp": "2025-08-22T06:05:51.193242"
    },
    {
      "test_id": "production_001",
      "domain": "production_efficiency",
      "query": "Calculate OEE for critical equipment showing downtime patterns",
      "generated_sql": "```sql WITH critical_equipment AS ( SELECT date, line_id, availability, performance, quality, (1 - availability) AS downtime FROM EQUIPMENT_METRICS WHERE equipment_type = %s ), oee AS ( SELECT date, line_id, availability * performance * quality AS oee, downtime FROM critical_equipment ) SELECT date, line_id, oee, downtime FROM oee ORDER BY date; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query calculates the OEE (Overall Equipment Effectiveness) for critical equipment and shows the downtime patterns. The query first filters the EQUIPMENT_METRICS table for rows where the equipment_type is 'Critical'. It then calculates the OEE and downtime for each row. The downtime is calculated as 1 - availability. The results are then ordered by date.",
      "safety_check": true,
      "quality_score": 0.30000000000000004,
      "concept_coverage": 1.0,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-22T06:05:58.564127"
    },
    {
      "test_id": "maintenance_001",
      "domain": "maintenance",
      "query": "Show equipment with MTBF below target requiring immediate attention",
      "generated_sql": "SELECT 'Error: Could not generate safe SQL' as error_message",
      "confidence": 0.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": "Query processing failed: Safety validation failed: Empty SQL query",
      "safety_check": false,
      "quality_score": 0.3,
      "concept_coverage": 0.0,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-22T06:06:01.379242"
    },
    {
      "test_id": "compliance_001",
      "domain": "compliance",
      "query": "Analyze CAPA effectiveness for recurring quality issues",
      "generated_sql": "```sql WITH recurring_issues AS ( SELECT ncm_id, COUNT(*) AS recurrence_count FROM non_conformant_materials GROUP BY ncm_id HAVING COUNT(*) > 1 ), capa_effectiveness AS ( SELECT ca.ncm_id, AVG(ca.effectiveness_score) AS avg_effectiveness FROM corrective_actions ca JOIN recurring_issues ri ON ca.ncm_id = ri.ncm_id GROUP BY ca.ncm_id ) SELECT ri.ncm_id, ri.recurrence_count, ce.avg_effectiveness FROM recurring_issues ri JOIN capa_effectiveness ce ON ri.ncm_id = ce.ncm_id ORDER BY ri.recurrence_count DESC, ce.avg_effectiveness ASC; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query first identifies recurring quality issues by counting the number of times each NCM incident occurs in the non_conformant_materials table. It then calculates the average effectiveness score for each NCM incident in the corrective_actions table. The final SELECT statement joins these two derived tables on the ncm_id and returns the NCM ID, recurrence count, and average effectiveness score. The results are ordered by recurrence count in descending order and average effectiveness score in ascending order, which prioritizes issues that occur frequently and have low effectiveness scores.",
      "safety_check": true,
      "quality_score": 0.55,
      "concept_coverage": 1.0,
      "contextual_hints_count": 4,
      "acronyms_detected": 3,
      "timestamp": "2025-08-22T06:06:08.894278"
    }
  ],
  "summary_statistics": {
    "total_tests": 5,
    "successful_tests": 5,
    "success_rate": 1.0,
    "average_quality": 0.41000000000000003,
    "average_confidence": 0.78,
    "average_concept_coverage": 0.55,
    "total_acronyms_detected": 14,
    "safety_compliance": 0.8
  },
  "domain_analysis": {
    "supply_chain": {
      "count": 1,
      "quality_scores": [
        0.4
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.25
      ],
      "avg_quality": 0.4,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.25
    },
    "quality_control": {
      "count": 1,
      "quality_scores": [
        0.5
      ],
      "confidence_scores": [
        0.9
      ],
      "concept_coverage": [
        0.5
      ],
      "avg_quality": 0.5,
      "avg_confidence": 0.9,
      "avg_concept_coverage": 0.5
    },
    "production_efficiency": {
      "count": 1,
      "quality_scores": [
        0.30000000000000004
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.30000000000000004,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    },
    "maintenance": {
      "count": 1,
      "quality_scores": [
        0.3
      ],
      "confidence_scores": [
        0.0
      ],
      "concept_coverage": [
        0.0
      ],
      "avg_quality": 0.3,
      "avg_confidence": 0.0,
      "avg_concept_coverage": 0.0
    },
    "compliance": {
      "count": 1,
      "quality_scores": [
        0.55
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.55,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    }
  },
  "research_insights": [
    "High success rate indicates robust SQL generation capabilities",
    "SQL quality could be improved through better domain knowledge integration",
    "Business concept recognition needs enhancement for better domain alignment",
    "Strongest performance in compliance domain (quality: 0.55)",
    "Contextual hints successfully detected 14 manufacturing acronyms"
  ]
}