{
  "timestamp": "2025-08-29T01:55:17.000821",
  "test_results": [
    {
      "test_id": "supply_chain_001",
      "domain": "supply_chain",
      "query": "Show suppliers with delivery performance below 95% affecting production schedule",
      "generated_sql": "```sql SELECT s.supplier_id, s.supplier_name, AVG(d.ontime_rate) AS average_ontime_rate FROM SUPPLIERS s JOIN DAILY_DELIVERIES d ON s.supplier_id = d.supplier_id GROUP BY s.supplier_id, s.supplier_name HAVING AVG(d.ontime_rate) < %s; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query joins the SUPPLIERS and DAILY_DELIVERIES tables on the supplier_id field. It then groups the results by supplier_id and supplier_name, and calculates the average ontime_rate for each supplier. The HAVING clause filters out any suppliers with an average ontime_rate of 95% or higher, leaving only those suppliers with an average ontime_rate below 95%.",
      "safety_check": true,
      "quality_score": 0.4,
      "concept_coverage": 0.25,
      "contextual_hints_count": 3,
      "acronyms_detected": 2,
      "timestamp": "2025-08-29T01:54:12.743365"
    },
    {
      "test_id": "quality_001",
      "domain": "quality_control",
      "query": "Find products with NCM rates trending above industry standards",
      "generated_sql": "```sql WITH defect_trends AS ( SELECT product_line, AVG(defect_rate) OVER (PARTITION BY product_line ORDER BY production_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS moving_average_defect_rate FROM PRODUCT_DEFECTS WHERE defect_type = %s ) SELECT p.id, p.description, dt.product_line, dt.moving_average_defect_rate FROM products p JOIN defect_trends dt ON p.description = dt.product_line WHERE dt.moving_average_defect_rate > %s; ```",
      "confidence": 0.9,
      "complexity": "QueryComplexity.COMPLEX",
      "explanation": " This query first creates a CTE (Common Table Expression) named 'defect_trends' that calculates the moving average of the defect rate for each product line over a 7-day window (current day and 6 preceding days). This is done using the AVG() function with an OVER clause to create a window of rows for each product line, ordered by production date. The WHERE clause in the CTE filters for defects of type 'NCM'. The main SELECT statement then joins the 'products' table with the 'defect_trends' CTE on the product description and product line. The WHERE clause in the main SELECT statement filters for products where the moving average defect rate is greater than the industry standard of 2.5% (0.025).",
      "safety_check": true,
      "quality_score": 0.4,
      "concept_coverage": 0.75,
      "contextual_hints_count": 5,
      "acronyms_detected": 5,
      "timestamp": "2025-08-29T01:54:27.194237"
    },
    {
      "test_id": "production_001",
      "domain": "production_efficiency",
      "query": "Calculate OEE for critical equipment showing downtime patterns",
      "generated_sql": "``` WITH critical_equipment AS ( SELECT e.line_id, e.date, e.availability, e.performance, e.quality, (e.availability * e.performance * e.quality) AS oee, f.downtime_hours FROM equipment_metrics e LEFT JOIN failure_events f ON e.equipment_id = f.equipment_id WHERE e.equipment_type = %s ), downtime_pattern AS ( SELECT date, SUM(downtime_hours) AS total_downtime FROM critical_equipment GROUP BY date ) SELECT c.date, c.oee, d.total_downtime FROM critical_equipment c JOIN downtime_pattern d ON c.date = d.date ORDER BY c.date; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " The query first creates a temporary table 'critical_equipment' that selects all the critical equipment from the 'equipment_metrics' table and calculates the OEE for each. It also joins this with the 'failure_events' table to get the downtime hours for each equipment. Then, it creates another temporary table 'downtime_pattern' that groups the total downtime hours by date. Finally, it joins these two tables on the date to get the OEE and total downtime for each date.",
      "safety_check": true,
      "quality_score": 0.5,
      "concept_coverage": 1.0,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-29T01:54:43.332890"
    },
    {
      "test_id": "maintenance_001",
      "domain": "maintenance",
      "query": "Show equipment with MTBF below target requiring immediate attention",
      "generated_sql": "```sql SELECT e.equipment_id, e.equipment_type, r.mtbf_hours, r.target_mtbf FROM EQUIPMENT_METRICS e JOIN EQUIPMENT_RELIABILITY r ON e.equipment_id = r.equipment_id WHERE r.mtbf_hours < r.target_mtbf; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query joins the EQUIPMENT_METRICS and EQUIPMENT_RELIABILITY tables on the equipment_id field. It then selects the equipment_id, equipment_type, mtbf_hours, and target_mtbf fields where the mtbf_hours (Mean Time Between Failures) is less than the target_mtbf. This will return all equipment where the actual MTBF is below the target, indicating that these pieces of equipment require immediate attention.",
      "safety_check": true,
      "quality_score": 0.35000000000000003,
      "concept_coverage": 0.75,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-29T01:54:56.655673"
    },
    {
      "test_id": "compliance_001",
      "domain": "compliance",
      "query": "Analyze CAPA effectiveness for recurring quality issues",
      "generated_sql": "```sql WITH recurring_issues AS ( SELECT ncm_id, COUNT(*) as recurrence_count FROM non_conformant_materials GROUP BY ncm_id HAVING COUNT(*) > 1 ), capa_effectiveness AS ( SELECT ca.ncm_id, AVG(ca.effectiveness_score) as avg_effectiveness FROM corrective_actions ca INNER JOIN recurring_issues ri ON ca.ncm_id = ri.ncm_id GROUP BY ca.ncm_id ) SELECT ri.ncm_id, ri.recurrence_count, ce.avg_effectiveness FROM recurring_issues ri INNER JOIN capa_effectiveness ce ON ri.ncm_id = ce.ncm_id ORDER BY ri.recurrence_count DESC, ce.avg_effectiveness ASC; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query first identifies recurring quality issues by counting the number of times each NCM incident occurs in the non_conformant_materials table. It then calculates the average effectiveness of the corrective actions associated with each recurring issue. The final result is a list of recurring issues, sorted by the number of recurrences and the average effectiveness of the corrective actions.",
      "safety_check": true,
      "quality_score": 0.55,
      "concept_coverage": 1.0,
      "contextual_hints_count": 4,
      "acronyms_detected": 3,
      "timestamp": "2025-08-29T01:55:17.000684"
    }
  ],
  "summary_statistics": {
    "total_tests": 5,
    "successful_tests": 5,
    "success_rate": 1.0,
    "average_quality": 0.44000000000000006,
    "average_confidence": 0.9800000000000001,
    "average_concept_coverage": 0.75,
    "total_acronyms_detected": 14,
    "safety_compliance": 1.0
  },
  "domain_analysis": {
    "supply_chain": {
      "count": 1,
      "quality_scores": [
        0.4
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.25
      ],
      "avg_quality": 0.4,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.25
    },
    "quality_control": {
      "count": 1,
      "quality_scores": [
        0.4
      ],
      "confidence_scores": [
        0.9
      ],
      "concept_coverage": [
        0.75
      ],
      "avg_quality": 0.4,
      "avg_confidence": 0.9,
      "avg_concept_coverage": 0.75
    },
    "production_efficiency": {
      "count": 1,
      "quality_scores": [
        0.5
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.5,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    },
    "maintenance": {
      "count": 1,
      "quality_scores": [
        0.35000000000000003
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.75
      ],
      "avg_quality": 0.35000000000000003,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.75
    },
    "compliance": {
      "count": 1,
      "quality_scores": [
        0.55
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.55,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    }
  },
  "research_insights": [
    "High success rate indicates robust SQL generation capabilities",
    "SQL quality could be improved through better domain knowledge integration",
    "Strong business concept coverage in generated queries",
    "Strongest performance in compliance domain (quality: 0.55)",
    "Contextual hints successfully detected 14 manufacturing acronyms"
  ]
}