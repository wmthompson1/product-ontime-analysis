{
  "timestamp": "2025-08-22T06:06:56.789751",
  "test_results": [
    {
      "test_id": "supply_chain_001",
      "domain": "supply_chain",
      "query": "Show suppliers with delivery performance below 95% affecting production schedule",
      "generated_sql": "```sql SELECT s.supplier_id, s.supplier_name, AVG(d.ontime_rate) AS average_ontime_rate FROM SUPPLIERS s JOIN DAILY_DELIVERIES d ON s.supplier_id = d.supplier_id GROUP BY s.supplier_id, s.supplier_name HAVING AVG(d.ontime_rate) < %s ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query joins the SUPPLIERS and DAILY_DELIVERIES tables on the supplier_id field. It then groups the results by supplier_id and supplier_name, and calculates the average ontime_rate for each supplier. The HAVING clause filters out suppliers with an average ontime_rate of 95% or higher, leaving only those suppliers with an average ontime_rate below 95%.",
      "safety_check": true,
      "quality_score": 0.4,
      "concept_coverage": 0.25,
      "contextual_hints_count": 3,
      "acronyms_detected": 2,
      "timestamp": "2025-08-22T06:06:27.496191"
    },
    {
      "test_id": "quality_001",
      "domain": "quality_control",
      "query": "Find products with NCM rates trending above industry standards",
      "generated_sql": "```sql WITH defect_trend AS ( SELECT pd.product_line, AVG(pd.defect_rate) OVER (PARTITION BY pd.product_line ORDER BY pd.production_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS moving_average_defect_rate FROM PRODUCT_DEFECTS pd WHERE pd.defect_type = %s ) SELECT dt.product_line, dt.moving_average_defect_rate FROM defect_trend dt WHERE dt.moving_average_defect_rate > %s ORDER BY dt.moving_average_defect_rate DESC ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.MEDIUM",
      "explanation": " This query first creates a CTE (Common Table Expression) named 'defect_trend' that calculates the moving average of the defect rate for each product line over a 7-day window (current day and 6 preceding days). This is done using the AVG() function with an OVER clause to specify the window of rows used for each calculation. The PARTITION BY clause is used to calculate a separate moving average for each product line. The WHERE clause in the CTE filters for defect type 'NCM'. The main SELECT statement then filters the results from the 'defect_trend' CTE to only include product lines where the moving average defect rate is greater than the industry standard of 2.5% (0.025). The results are ordered by the moving average defect rate in descending order.",
      "safety_check": true,
      "quality_score": 0.30000000000000004,
      "concept_coverage": 0.75,
      "contextual_hints_count": 5,
      "acronyms_detected": 5,
      "timestamp": "2025-08-22T06:06:38.545129"
    },
    {
      "test_id": "production_001",
      "domain": "production_efficiency",
      "query": "Calculate OEE for critical equipment showing downtime patterns",
      "generated_sql": "```sql WITH critical_equipment AS ( SELECT line_id, date, availability, performance, quality, (1 - availability) AS downtime FROM EQUIPMENT_METRICS WHERE equipment_type = %s ), oee AS ( SELECT line_id, date, availability * performance * quality AS oee, downtime FROM critical_equipment ) SELECT line_id, date, oee, downtime FROM oee ORDER BY date; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " The query first creates a temporary table 'critical_equipment' that selects all the critical equipment from the 'EQUIPMENT_METRICS' table and calculates the downtime as (1 - availability). Then, it creates another temporary table 'oee' that calculates the OEE for each piece of critical equipment as the product of availability, performance, and quality. Finally, it selects the line_id, date, OEE, and downtime from the 'oee' table and orders the results by date.",
      "safety_check": true,
      "quality_score": 0.30000000000000004,
      "concept_coverage": 1.0,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-22T06:06:46.328824"
    },
    {
      "test_id": "maintenance_001",
      "domain": "maintenance",
      "query": "Show equipment with MTBF below target requiring immediate attention",
      "generated_sql": "SELECT 'Error: Could not generate safe SQL' as error_message",
      "confidence": 0.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": "Query processing failed: Safety validation failed: Empty SQL query",
      "safety_check": false,
      "quality_score": 0.3,
      "concept_coverage": 0.0,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-22T06:06:49.524251"
    },
    {
      "test_id": "compliance_001",
      "domain": "compliance",
      "query": "Analyze CAPA effectiveness for recurring quality issues",
      "generated_sql": "```sql WITH recurring_issues AS ( SELECT ncm_id, COUNT(*) as recurrence_count FROM non_conformant_materials GROUP BY ncm_id HAVING COUNT(*) > 1 ), capa_effectiveness AS ( SELECT ca.ncm_id, AVG(ca.effectiveness_score) as avg_effectiveness_score FROM corrective_actions ca JOIN recurring_issues ri ON ca.ncm_id = ri.ncm_id GROUP BY ca.ncm_id ) SELECT ri.ncm_id, ri.recurrence_count, ce.avg_effectiveness_score FROM recurring_issues ri JOIN capa_effectiveness ce ON ri.ncm_id = ce.ncm_id ORDER BY ri.recurrence_count DESC, ce.avg_effectiveness_score ASC; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query first identifies the recurring quality issues by counting the number of times each NCM incident occurs in the non_conformant_materials table. It then calculates the average effectiveness score of the corrective actions associated with each recurring issue. The final result is a list of recurring issues (identified by their NCM IDs), the number of times each issue has recurred, and the average effectiveness score of the corrective actions associated with each issue. The results are ordered by the recurrence count in descending order and the average effectiveness score in ascending order, so the most frequently recurring issues with the least effective corrective actions will appear first.",
      "safety_check": true,
      "quality_score": 0.55,
      "concept_coverage": 1.0,
      "contextual_hints_count": 4,
      "acronyms_detected": 3,
      "timestamp": "2025-08-22T06:06:56.789612"
    }
  ],
  "summary_statistics": {
    "total_tests": 5,
    "successful_tests": 5,
    "success_rate": 1.0,
    "average_quality": 0.37,
    "average_confidence": 0.8,
    "average_concept_coverage": 0.6,
    "total_acronyms_detected": 14,
    "safety_compliance": 0.8
  },
  "domain_analysis": {
    "supply_chain": {
      "count": 1,
      "quality_scores": [
        0.4
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.25
      ],
      "avg_quality": 0.4,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.25
    },
    "quality_control": {
      "count": 1,
      "quality_scores": [
        0.30000000000000004
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.75
      ],
      "avg_quality": 0.30000000000000004,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.75
    },
    "production_efficiency": {
      "count": 1,
      "quality_scores": [
        0.30000000000000004
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.30000000000000004,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    },
    "maintenance": {
      "count": 1,
      "quality_scores": [
        0.3
      ],
      "confidence_scores": [
        0.0
      ],
      "concept_coverage": [
        0.0
      ],
      "avg_quality": 0.3,
      "avg_confidence": 0.0,
      "avg_concept_coverage": 0.0
    },
    "compliance": {
      "count": 1,
      "quality_scores": [
        0.55
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.55,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    }
  },
  "research_insights": [
    "High success rate indicates robust SQL generation capabilities",
    "SQL quality could be improved through better domain knowledge integration",
    "Strong business concept coverage in generated queries",
    "Strongest performance in compliance domain (quality: 0.55)",
    "Contextual hints successfully detected 14 manufacturing acronyms"
  ]
}