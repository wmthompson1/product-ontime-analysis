{
  "timestamp": "2025-08-28T02:37:59.379840",
  "test_results": [
    {
      "test_id": "supply_chain_001",
      "domain": "supply_chain",
      "query": "Show suppliers with delivery performance below 95% affecting production schedule",
      "generated_sql": "```sql SELECT s.supplier_id, s.supplier_name, AVG(d.ontime_rate) AS average_ontime_rate FROM SUPPLIERS s JOIN DAILY_DELIVERIES d ON s.supplier_id = d.supplier_id GROUP BY s.supplier_id, s.supplier_name HAVING AVG(d.ontime_rate) < %s; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query joins the SUPPLIERS and DAILY_DELIVERIES tables on the supplier_id field. It then groups the results by supplier_id and supplier_name, and calculates the average ontime_rate for each supplier. The HAVING clause filters out suppliers with an average ontime_rate of 95% or higher, leaving only those suppliers with an average ontime_rate below 95%.",
      "safety_check": true,
      "quality_score": 0.4,
      "concept_coverage": 0.25,
      "contextual_hints_count": 3,
      "acronyms_detected": 2,
      "timestamp": "2025-08-28T02:37:21.602978"
    },
    {
      "test_id": "quality_001",
      "domain": "quality_control",
      "query": "Find products with NCM rates trending above industry standards",
      "generated_sql": "```sql WITH defect_trends AS ( SELECT product_line, DATE_TRUNC('month', production_date) AS month, AVG(defect_rate) AS monthly_avg_defect_rate FROM product_defects WHERE defect_type = %s GROUP BY product_line, month ) SELECT dt.product_line, dt.month, dt.monthly_avg_defect_rate, LAG(dt.monthly_avg_defect_rate) OVER (PARTITION BY dt.product_line ORDER BY dt.month) AS prev_month_avg_defect_rate FROM defect_trends dt WHERE dt.monthly_avg_defect_rate > %s AND dt.monthly_avg_defect_rate > prev_month_avg_defect_rate ORDER BY dt.product_line, dt.month; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.COMPLEX",
      "explanation": " This query first creates a CTE (Common Table Expression) named 'defect_trends' that calculates the average defect rate per month for each product line where the defect type is 'NCM'. Then, in the main query, it selects the product lines and months where the monthly average defect rate is greater than the industry standard (2.5%) and is increasing compared to the previous month. The LAG window function is used to get the defect rate of the previous month for each product line. The results are ordered by product line and month.",
      "safety_check": true,
      "quality_score": 0.30000000000000004,
      "concept_coverage": 0.75,
      "contextual_hints_count": 5,
      "acronyms_detected": 5,
      "timestamp": "2025-08-28T02:37:31.101055"
    },
    {
      "test_id": "production_001",
      "domain": "production_efficiency",
      "query": "Calculate OEE for critical equipment showing downtime patterns",
      "generated_sql": "```sql WITH critical_equipment AS ( SELECT e.line_id, e.date, e.availability * e.performance * e.quality AS oee, f.downtime_hours FROM equipment_metrics e LEFT JOIN failure_events f ON e.equipment_id = f.equipment_id WHERE e.equipment_type = %s ), downtime_pattern AS ( SELECT line_id, date, oee, SUM(downtime_hours) OVER (PARTITION BY line_id ORDER BY date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cumulative_downtime FROM critical_equipment ) SELECT line_id, date, oee, cumulative_downtime FROM downtime_pattern ORDER BY line_id, date; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query first creates a temporary table `critical_equipment` that selects the line_id, date, OEE (calculated as the product of availability, performance, and quality), and downtime_hours from the `equipment_metrics` table where the equipment_type is 'Critical'. It also joins the `failure_events` table to get the downtime_hours for each equipment. Then, it creates another temporary table `downtime_pattern` that calculates the cumulative downtime for each line_id over time using a window function. Finally, it selects the line_id, date, OEE, and cumulative_downtime from the `downtime_pattern` table and orders the result by line_id and date.",
      "safety_check": true,
      "quality_score": 0.5,
      "concept_coverage": 1.0,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-28T02:37:44.012957"
    },
    {
      "test_id": "maintenance_001",
      "domain": "maintenance",
      "query": "Show equipment with MTBF below target requiring immediate attention",
      "generated_sql": "```sql SELECT e.equipment_id, e.equipment_type, r.mtbf_hours, r.target_mtbf FROM equipment_metrics AS e JOIN equipment_reliability AS r ON e.equipment_id = r.equipment_id WHERE r.mtbf_hours < r.target_mtbf; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query joins the `equipment_metrics` and `equipment_reliability` tables on the `equipment_id` field. It then filters the results to only include rows where the `mtbf_hours` (Mean Time Between Failures) is less than the `target_mtbf`. This will return a list of equipment that is failing more frequently than its target rate, indicating that it requires immediate attention.",
      "safety_check": true,
      "quality_score": 0.35000000000000003,
      "concept_coverage": 0.75,
      "contextual_hints_count": 2,
      "acronyms_detected": 2,
      "timestamp": "2025-08-28T02:37:50.235560"
    },
    {
      "test_id": "compliance_001",
      "domain": "compliance",
      "query": "Analyze CAPA effectiveness for recurring quality issues",
      "generated_sql": "```sql WITH recurring_issues AS ( SELECT ncm_id, COUNT(*) AS recurrence_count FROM non_conformant_materials GROUP BY ncm_id HAVING COUNT(*) > 1 ), capa_effectiveness AS ( SELECT capa_id, ncm_id, effectiveness_score FROM corrective_actions WHERE ncm_id IN (SELECT ncm_id FROM recurring_issues) ) SELECT ncm_id, AVG(effectiveness_score) AS average_effectiveness FROM capa_effectiveness GROUP BY ncm_id ORDER BY average_effectiveness DESC; ```",
      "confidence": 1.0,
      "complexity": "QueryComplexity.SIMPLE",
      "explanation": " This query first identifies the recurring quality issues by counting the number of times each NCM incident has occurred and filtering for those that have occurred more than once. It then selects the CAPA records associated with these recurring issues and calculates the average effectiveness score for each NCM incident. The results are sorted in descending order of average effectiveness score.",
      "safety_check": true,
      "quality_score": 0.5,
      "concept_coverage": 1.0,
      "contextual_hints_count": 4,
      "acronyms_detected": 3,
      "timestamp": "2025-08-28T02:37:59.379768"
    }
  ],
  "summary_statistics": {
    "total_tests": 5,
    "successful_tests": 5,
    "success_rate": 1.0,
    "average_quality": 0.41000000000000003,
    "average_confidence": 1.0,
    "average_concept_coverage": 0.75,
    "total_acronyms_detected": 14,
    "safety_compliance": 1.0
  },
  "domain_analysis": {
    "supply_chain": {
      "count": 1,
      "quality_scores": [
        0.4
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.25
      ],
      "avg_quality": 0.4,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.25
    },
    "quality_control": {
      "count": 1,
      "quality_scores": [
        0.30000000000000004
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.75
      ],
      "avg_quality": 0.30000000000000004,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.75
    },
    "production_efficiency": {
      "count": 1,
      "quality_scores": [
        0.5
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.5,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    },
    "maintenance": {
      "count": 1,
      "quality_scores": [
        0.35000000000000003
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        0.75
      ],
      "avg_quality": 0.35000000000000003,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 0.75
    },
    "compliance": {
      "count": 1,
      "quality_scores": [
        0.5
      ],
      "confidence_scores": [
        1.0
      ],
      "concept_coverage": [
        1.0
      ],
      "avg_quality": 0.5,
      "avg_confidence": 1.0,
      "avg_concept_coverage": 1.0
    }
  },
  "research_insights": [
    "High success rate indicates robust SQL generation capabilities",
    "SQL quality could be improved through better domain knowledge integration",
    "Strong business concept coverage in generated queries",
    "Strongest performance in production_efficiency domain (quality: 0.50)",
    "Contextual hints successfully detected 14 manufacturing acronyms"
  ]
}